# KRAI Test Environment Configuration
# =====================================
# 
# This file contains configuration for running KRAI tests in an isolated
# test environment. Values here override the main .env file during testing.
#
# Usage: Copy to .env.test and modify for your test environment

# Testing Flags
TESTING=true
LOG_LEVEL=DEBUG

# Database Configuration (Test Database)
# --------------------------------------
# Use a separate test database to avoid affecting production data
DATABASE_URL=postgresql://krai_test:krai_test_password@localhost:5433/krai_test
POSTGRES_DB=krai_test
POSTGRES_USER=krai_test
POSTGRES_PASSWORD=krai_test_password

# Alternative: Use test schema in same database
# DATABASE_URL=postgresql://krai_user:krai_password@localhost:5432/krai_db
# TEST_SCHEMA_PREFIX=test

# Storage Configuration (Test Buckets)
# ------------------------------------
# Use separate test buckets to avoid affecting production files
MINIO_ENDPOINT=localhost:9001
MINIO_ACCESS_KEY=test_access_key
MINIO_SECRET_KEY=test_secret_key
MINIO_USE_SSL=false

# Test bucket names (will be created automatically)
TEST_DOCUMENTS_BUCKET=test-documents
TEST_IMAGES_BUCKET=test-images
TEST_VIDEOS_BUCKET=test-videos
TEST_TABLES_BUCKET=test-tables
TEST_TEMP_BUCKET=test-temp

# AI Service Configuration (Test Mode)
# ------------------------------------
# Use test API keys or local models to avoid affecting production metrics
OPENAI_API_KEY=sk-test-key-for-testing-only
OLLAMA_BASE_URL=http://localhost:11435

# Test model configuration
OPENAI_MODEL=gpt-3.5-turbo
OLLAMA_MODEL=llama2
EMBEDDING_MODEL=text-embedding-ada-002

# Feature Flags (Test Configuration)
# ----------------------------------
# Enable all features for comprehensive testing
ENABLE_SVG_EXTRACTION=true
ENABLE_HIERARCHICAL_CHUNKING=true
ENABLE_TABLE_EXTRACTION=true
ENABLE_CONTEXT_EXTRACTION=true
ENABLE_MULTIMODAL_SEARCH=true

# Processing Configuration (Test Optimized)
# -----------------------------------------
# Smaller batch sizes and timeouts for faster test execution
EMBEDDING_BATCH_SIZE=10
PROCESSING_TIMEOUT=300
MAX_CONCURRENT_PROCESSES=2

# Search Configuration (Test Defaults)
# ------------------------------------
DEFAULT_SEARCH_THRESHOLD=0.5
DEFAULT_SEARCH_LIMIT=10
MAX_SEARCH_RESULTS=50

# Logging Configuration (Test Verbose)
# ------------------------------------
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_FILE=test.log
ENABLE_QUERY_LOGGING=true

# Performance Configuration (Test Optimized)
# -------------------------------------------
# Lower resource limits for test environment
MAX_MEMORY_MB=2048
MAX_CPU_PERCENT=50
DATABASE_POOL_SIZE=5
CONNECTION_TIMEOUT=30

# Security Configuration (Test Relaxed)
# -------------------------------------
# Less strict security for test environment
CORS_ORIGIN=http://localhost:3000,http://localhost:5173
API_RATE_LIMIT=1000
ENABLE_AUTH=false

# Monitoring and Metrics (Test Mode)
# ----------------------------------
# Disable external monitoring in tests
ENABLE_METRICS=false
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_INTERVAL=30

# Migration Configuration (Test)
# -------------------------------
# Auto-apply migrations in test environment
AUTO_APPLY_MIGRATIONS=true
MIGRATION_TIMEOUT=120

# Cleanup Configuration (Test)
# -----------------------------
# Automatic cleanup after tests
CLEANUP_TEST_DATA=true
PRESERVE_TEST_BUCKETS=false
CLEANUP_INTERVAL=3600

# External Service Configuration (Mock)
# --------------------------------------
# Mock external services for testing
MOCK_EXTERNAL_APIS=true
MOCK_NOTIFICATIONS=true
MOCK_EMAIL_SERVICE=true

# Test Data Configuration
# -----------------------
# Test file paths and sample data
TEST_DOCUMENTS_PATH=./tests/fixtures/documents
TEST_IMAGES_PATH=./tests/fixtures/images
TEST_VIDEOS_PATH=./tests/fixtures/videos

# Test Scenarios
# --------------
# Configure which test scenarios to run
RUN_SLOW_TESTS=false
RUN_INTEGRATION_TESTS=true
RUN_PERFORMANCE_TESTS=false
RUN_END_TO_END_TESTS=true

# Error Handling (Test Configuration)
# ------------------------------------
# Configure error handling for tests
FAIL_FAST=true
MAX_RETRY_ATTEMPTS=3
RETRY_DELAY=1

# Parallel Execution (Test)
# -------------------------
# Configure parallel test execution
MAX_PARALLEL_TESTS=4
ENABLE_PARALLEL=true

# Coverage Configuration
# ----------------------
# Code coverage settings
ENABLE_COVERAGE=true
COVERAGE_THRESHOLD=80
COVERAGE_OUTPUT=html

# Firecrawl Web Scraping Configuration (Test)
# --------------------------------------------
# Configure Firecrawl for testing
SCRAPING_BACKEND=beautifulsoup  # Default to BeautifulSoup for faster tests
FIRECRAWL_API_URL=http://localhost:3003  # Test Firecrawl API (port 3003)
FIRECRAWL_LLM_PROVIDER=ollama  # Use local Ollama for tests
FIRECRAWL_MODEL_NAME=llama3.2:latest
FIRECRAWL_EMBEDDING_MODEL=nomic-embed-text:latest
FIRECRAWL_BULL_AUTH_KEY=test_firecrawl_admin
FIRECRAWL_MAX_CONCURRENCY=2  # Lower for test environment
FIRECRAWL_BLOCK_MEDIA=true
FIRECRAWL_ALLOW_LOCAL_WEBHOOKS=true

# Mock mode for unit tests (no network calls)
SCRAPING_MOCK_MODE=false  # Set to true for pure unit tests

# Link Enrichment (Test)
ENABLE_LINK_ENRICHMENT=true
MAX_CONCURRENT_ENRICHMENTS=2
ENRICHMENT_TIMEOUT=30
RETRY_FAILED_AFTER_HOURS=1  # Shorter for tests

# Manufacturer Crawler (Test)
ENABLE_MANUFACTURER_CRAWLING=true
CRAWLER_MAX_CONCURRENT_JOBS=1
CRAWLER_DEFAULT_MAX_PAGES=10  # Smaller for tests
CRAWLER_DEFAULT_MAX_DEPTH=2

# Structured Extraction (Test)
EXTRACTION_CONFIDENCE_THRESHOLD=0.5
EXTRACTION_TIMEOUT=60

# Test Scenarios for Firecrawl
# ----------------------------
RUN_FIRECRAWL_TESTS=true  # Enable Firecrawl-specific tests
RUN_FALLBACK_TESTS=true  # Test Firecrawl -> BeautifulSoup fallback
RUN_LLM_PROVIDER_TESTS=true  # Test Ollama/OpenAI switching
TEST_WITH_REAL_FIRECRAWL=false  # Use mock mode by default
