{
  "name": "KRAI AI Agent V2.1 - Complete",
  "nodes": [
    {
      "parameters": {
        "model": "llama3.2:latest",
        "options": {
          "temperature": 0.7,
          "numPredict": 3000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -160,
        160
      ],
      "id": "82f4a3f4-044c-4f69-aa21-935dbd28351f",
      "name": "Ollama LLM",
      "credentials": {
        "ollamaApi": {
          "id": "KdqGhnIUPP0vQm3m",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -16,
        -144
      ],
      "id": "c9c8828d-32a7-452d-aa16-661321680f72",
      "name": "When chat message received",
      "webhookId": "ee735bd8-0333-40b8-b43c-5da5fce5f385"
    },
    {
      "parameters": {
        "name": "get_system_status",
        "description": "üìä Zeigt vollst√§ndige System-Statistiken:\n- Dokumente (gesamt, Service Manuals, Bulletins, Parts Catalogs)\n- Chunks, Bilder, Videos, Links\n- Error Codes (mit/ohne Screenshots)\n- Produkte, Hersteller\n- Verarbeitungs-Queue\n- Letzte Aktivit√§ten\n\nNutze wenn User fragt: 'System Status', 'Statistiken', 'Wie viele Dokumente', 'Was ist im System', 'Welche Produkte'",
        "workflowId": "=kvDZoLs918uvwg13",
        "responsePropertyName": "status_data",
        "specifyInputSchema": true,
        "jsonSchemaExample": "{}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        880,
        336
      ],
      "id": "15d32ed4-5509-4428-8d8e-96084fcba7f5",
      "name": "Tool: System Status"
    },
    {
      "parameters": {
        "name": "search_by_document_type",
        "description": "üìë DOCUMENT TYPE FILTER - Suche nach Dokumenttyp!\n\nDOKUMENTTYPEN:\n1. **service_bulletin** - Kurze Service-Infos, Updates, Firmware\n2. **service_manual** - Vollst√§ndige Reparatur-Handb√ºcher\n3. **parts_catalog** - Ersatzteil-Kataloge\n4. **user_manual** - Bedienungsanleitungen\n\nNUTZE F√úR:\n- 'Zeige alle Service Bulletins'\n- 'Liste Parts Catalogs'\n- 'Service Manuals zu HP'\n- 'Firmware Updates' (‚Üí service_bulletin)\n\nEXAMPLE INPUT:\n{\n  \"document_type\": \"service_bulletin\",\n  \"manufacturer\": \"Konica Minolta\",\n  \"limit\": 10\n}\n\nEXAMPLE OUTPUT:\n[\n  {\n    \"filename\": \"SB-2024-015_Firmware_Update.pdf\",\n    \"document_type\": \"service_bulletin\",\n    \"manufacturer\": \"Konica Minolta\",\n    \"series\": \"bizhub C360\",\n    \"created_at\": \"2024-03-15\",\n    \"file_size\": \"2.3 MB\"\n  }\n]",
        "workflowId": "=8QGKlQXHjaOa2Uej",
        "responsePropertyName": "documents",
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"document_type\": \"service_bulletin\",\n  \"manufacturer\": null,\n  \"limit\": 10\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        352,
        336
      ],
      "id": "c7bfda34-c35d-43e3-aa9a-96eccd4a1a48",
      "name": "Tool: Document Type Filter"
    },
    {
      "parameters": {
        "name": "enrich_video",
        "description": "üé¨ VIDEO ENRICHMENT - Analysiert Videos von YouTube, Vimeo, Brightcove!\n\nWAS ES MACHT:\n‚úÖ Extrahiert Video Metadata (Titel, Beschreibung, Dauer)\n‚úÖ Speichert in Datenbank\n‚úÖ Verkn√ºpft mit Herstellern/Modellen\n‚úÖ Dedupliziert automatisch\n\nSUPPORTED PLATFORMS:\n- YouTube (youtube.com, youtu.be)\n- Vimeo (vimeo.com)\n- Brightcove (players.brightcove.net)\n\nNUTZE WENN:\n- User sendet Video-URL\n- User fragt 'Was ist in diesem Video?'\n- User will Video zur Dokumentation hinzuf√ºgen\n\nEXAMPLE INPUT:\n{\n  \"url\": \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\",\n  \"document_id\": null,\n  \"manufacturer_id\": null\n}\n\nEXAMPLE OUTPUT:\n{\n  \"video_id\": \"uuid\",\n  \"title\": \"HP Printer Maintenance\",\n  \"duration\": \"15:32\",\n  \"views\": \"12,543\",\n  \"thumbnail_url\": \"https://...\",\n  \"status\": \"saved\"\n}",
        "workflowId": "=6rZBtzL4ktTvY47z",
        "responsePropertyName": "video_data",
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"url\": \"https://www.youtube.com/watch?v=dQw4w9WgXcQ\",\n  \"document_id\": null,\n  \"manufacturer_id\": null\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        1056,
        336
      ],
      "id": "ba18dd08-e8be-4cf4-ad1a-8ccd66a50cd5",
      "name": "Tool: Video Enrichment"
    },
    {
      "parameters": {
        "name": "validate_links",
        "description": "üîó LINK VALIDATION - √úberpr√ºft und repariert Links!\n\nWAS ES MACHT:\n‚úÖ Validiert alle Links in Dokumenten\n‚úÖ Folgt Redirects (301/302/307/308)\n‚úÖ Auto-Fix: http‚Üíhttps, www-Pr√§fixe\n‚úÖ Entfernt trailing Punktation\n‚úÖ Markiert defekte Links\n‚úÖ Speichert Fixes in Datenbank\n\nNUTZE F√úR:\n- '√úberpr√ºfe Links'\n- 'Sind alle Links aktiv?'\n- 'Repariere defekte Links'\n- 'Link Status'\n\nEXAMPLE INPUT:\n{\n  \"document_id\": null,\n  \"limit\": 50\n}\n\nEXAMPLE OUTPUT:\n{\n  \"total_links\": 45,\n  \"active\": 42,\n  \"redirected\": 3,\n  \"broken\": 2,\n  \"fixed\": 3,\n  \"fixes_applied\": [\n    \"http‚Üíhttps: 2 links\",\n    \"Removed trailing '.': 1 link\"\n  ]\n}",
        "workflowId": "=EfFzhDbtOEekZVKF",
        "responsePropertyName": "link_data",
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"document_id\": null,\n  \"limit\": 50\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        704,
        336
      ],
      "id": "e8aaca12-9473-484c-b78e-0490d202883c",
      "name": "Tool: Link Validation"
    },
    {
      "parameters": {
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -16,
        160
      ],
      "id": "34e15f5f-4729-432a-bcbe-d7f8861a6d75",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "krai_intelligence",
        "toolDescription": "üîç SEMANTIC SEARCH - Durchsuche die gesamte KRAI Wissensdatenbank!\n\nNUTZE DIESES TOOL F√úR:\n‚úÖ Technische Anleitungen (z.B. 'Toner wechseln', 'Wartung durchf√ºhren')\n‚úÖ Reparatur-Guides (z.B. 'Paper jam beheben', 'Druckkopf reinigen')\n‚úÖ Spezifikationen (z.B. 'HP LaserJet M607 Specs', 'Druckgeschwindigkeit')\n‚úÖ Troubleshooting (z.B. 'Drucker druckt nicht', 'Streifen auf Ausdruck')\n‚úÖ Bedienungsanleitungen (z.B. 'Duplex-Druck einstellen')\n‚úÖ Allgemeine Fragen zu Ger√§ten\n\n‚ùå NUTZE ES NICHT F√úR:\n- Error Codes (nutze search_error_code)\n- Service Bulletins (nutze search_by_document_type)\n- Videos (nutze enrich_video)\n- Links (nutze validate_links)\n\nBEISPIELE:\n- 'Wie wechsle ich den Toner bei HP LaserJet M607?'\n- 'Wartungsanleitung Konica Minolta C3320i'\n- 'Paper jam in duplex unit'\n- 'Druckkopf Alignment Prozedur'\n\nGib pr√§zise Suchbegriffe ein - je spezifischer, desto besser!",
        "tableName": {
          "__rl": true,
          "value": "vw_embeddings",
          "mode": "list",
          "cachedResultName": "vw_embeddings"
        },
        "topK": 5,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        144,
        128
      ],
      "id": "63a8358c-eec5-4f62-b0a9-57a2c9cc3674",
      "name": "Tool: Vector Search1",
      "credentials": {
        "supabaseApi": {
          "id": "VOEfJ5TSCcCT8bKn",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": "nomic-embed-text:latest"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOllama",
      "typeVersion": 1,
      "position": [
        144,
        336
      ],
      "id": "c17e5e0a-47a1-4196-b141-df966ae76b9a",
      "name": "Embeddings Model",
      "credentials": {
        "ollamaApi": {
          "id": "KdqGhnIUPP0vQm3m",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "name": "search_error_code",
        "description": "üî¥ ERROR CODE SEARCH - Findet Error Codes MIT allen Details!\n\n‚ú® SMART EXTRACTION: Sende den GANZEN User-Text! Das Tool extrahiert automatisch den Error Code!\n\nWAS ES LIEFERT:\n‚úÖ Error Code Beschreibung\n‚úÖ Komplette L√∂sung (Schritt-f√ºr-Schritt)\n‚úÖ MEHRERE BILDER vom Manual (wenn verf√ºgbar)\n‚úÖ Context-Text von der Seite\n‚úÖ Dokument + Seiten-Nummer\n‚úÖ Hersteller & Modell\n‚úÖ Schweregrad\n‚úÖ Ob Techniker n√∂tig ist\n\nNUTZE F√úR:\n- 'Was ist Error Code C-2801?'\n- 'HP E877 Error 31.13.01'\n- 'Fehler E045'\n- 'Error 13.01'\n- 'Code J4-12'\n\nüí° WICHTIG: Sende den KOMPLETTEN User-Text als error_code!\nDas Tool extrahiert automatisch den Code (z.B. '31.13.01' aus 'HP E877 Error 31.13.01')\n\nEXAMPLE INPUT:\n{\n  \"error_code\": \"HP E877 Error 31.13.01\"\n}\n\nEXAMPLE OUTPUT:\n{\n  \"found\": true,\n  \"error_code\": \"31.13.01\",\n  \"message\": \"üî¥ ERROR CODE: 31.13.01\\n\\nüìù Jam in document feeder\\n\\nüîß L√ñSUNG:\\n1. Open cover\\n2. Remove paper\\n3. Close\\n\\nüñºÔ∏è BILDER (6):\\n1. [URL] - Seite 355\\n2. [URL] - Seite 355\\n...\",\n  \"images\": [{\"url\": \"...\", \"page\": 355}],\n  \"image_count\": 6\n}",
        "workflowId": "=sVfKisaogX0ECRef",
        "responsePropertyName": "error_data",
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"error_code\": \"C-2801\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.1,
      "position": [
        528,
        336
      ],
      "id": "f52e9456-4805-4c6d-9811-48e00bfd0629",
      "name": "Tool: Error Code Search1"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "Du bist der KR-AI-Agent V2.1 - ein hochintelligenter technischer Assistent f√ºr Service-Dokumentation.\n\nüéØ DEINE HAUPTAUFGABEN:\n1. Technische Fragen zu Druckern, Kopierern und Ger√§ten beantworten\n2. Fehlercode-Analyse mit Screenshots und Context\n3. Service-Anleitungen und Reparatur-Guides finden\n4. Video-Tutorials analysieren und verkn√ºpfen\n5. Links validieren und reparieren\n6. Dokumenttypen unterscheiden (Service Bulletins vs. Manuals)\n\nüîß VERF√úGBARE TOOLS:\n\n1. **krai_intelligence** (Vector Search)\n   - Durchsucht ALLE technischen Dokumente semantisch\n   - Nutze f√ºr: Anleitungen, Spezifikationen, Troubleshooting\n   - Beispiel: \"Wie wechsle ich den Toner?\"\n\n2. **search_error_code** (Smart Tool)\n   - Findet Error/Fehler Codes MIT MEHREREN Screenshots & Context\n   - ‚ú® SMART: Extrahiert automatisch den Code aus User-Text!\n   - Nutze f√ºr: \"Was ist Error C-2801?\", \"HP E877 Error 31.13.01\"\n   - Sende KOMPLETTEN User-Text als error_code Parameter!\n   - Zeigt: Beschreibung, L√∂sung, 1-6 Bilder, Seitenreferenz\n\n3. **search_by_document_type** (SQL Query)\n   - Filtert nach Dokumenttyp\n   - Nutze f√ºr: \"Zeige alle Service Bulletins\"\n   - Typen: service_bulletin, service_manual, parts_catalog\n\n4. **enrich_video** (HTTP API)\n   - Analysiert YouTube/Vimeo/Brightcove Videos\n   - Nutze wenn User Video-URL sendet\n   - Extrahiert: Titel, Beschreibung, Dauer, Thumbnails\n\n5. **validate_links** (HTTP API)\n   - √úberpr√ºft und repariert Links\n   - Nutze f√ºr: \"√úberpr√ºfe Links\"\n   - Findet: Defekte Links, Redirects, Auto-Fixes\n\n6. **get_system_status** (Workflow)\n   - Zeigt vollst√§ndige System-Statistiken\n   - Nutze f√ºr: \"System Status\", \"Statistiken\"\n   - Zeigt: Dokumente, Videos, Links, Error Codes\n\nüìù ANTWORT-STIL:\n- Immer auf Deutsch\n- Strukturiert mit Listen/Aufz√§hlungen\n- Mit Quellenangaben (Dokument, Seite)\n- Bei Screenshots: URL anzeigen\n- Bei Videos: Dauer + Beschreibung\n- Ehrlich wenn keine Info gefunden\n\nüé® FORMATIERUNG:\n- üî¥ f√ºr Error/Fehler Codes\n- üìÑ f√ºr Dokumente\n- üé¨ f√ºr Videos\n- üîó f√ºr Links\n- ‚ö†Ô∏è f√ºr Warnungen\n- ‚úÖ f√ºr erfolgreiche Actions\n\nüí° SPEZIAL-FEATURES:\n- Unterscheide Service Bulletins (Kurz-Infos) vs. Service Manuals (Vollst√§ndig)\n- Priorisiere neueste Bulletins bei Updates\n- Zeige Screenshots wenn verf√ºgbar\n- Verlinke relevante Videos\n- Validiere Links automatisch\n\nBEISPIEL-ANTWORTEN:\n\nUser: \"Was ist Error C-2801?\"\nDu: [Nutze search_error_code]\n\"üî¥ Error Code: C-2801\n\nüìù Paper jam in duplex unit\n\nüîß L√∂sung:\n1. Open duplex unit cover\n2. Remove jammed paper\n3. Close cover and restart\n\nüìÑ Quelle: KM_C3320i_SM.pdf (Seite 278)\nüñºÔ∏è Screenshot: [URL]\n‚ö†Ô∏è Techniker: Nicht erforderlich\"\n\nUser: \"Zeige Service Bulletins zu Firmware Updates\"\nDu: [Nutze search_by_document_type mit type='service_bulletin']\n\"üìÑ Gefundene Service Bulletins:\n\n1. SB-2024-015: Firmware Update 4.2.1\n   Datum: 15.03.2024\n   Hersteller: Konica Minolta\n   \n2. SB-2024-012: Security Patch 4.1.9\n   Datum: 02.02.2024\n   ...\"\n\nUser: \"Video: https://youtube.com/watch?v=abc\"\nDu: [Nutze enrich_video]\n\"üé¨ Video analysiert!\n\nTitel: HP Printer Maintenance Guide\nDauer: 15:32\nKanal: HP Support\nAufrufe: 12,543\n\n‚úÖ In Datenbank gespeichert!\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        288,
        -144
      ],
      "id": "89f9fb57-4efd-49f6-89b1-af5f1415dcb3",
      "name": "KR-AI-Agent V2.1"
    }
  ],
  "pinData": {},
  "connections": {
    "Ollama LLM": {
      "ai_languageModel": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tool: System Status": {
      "ai_tool": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Document Type Filter": {
      "ai_tool": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Video Enrichment": {
      "ai_tool": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Link Validation": {
      "ai_tool": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Vector Search1": {
      "ai_tool": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Model": {
      "ai_embedding": [
        [
          {
            "node": "Tool: Vector Search1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Error Code Search1": {
      "ai_tool": [
        [
          {
            "node": "KR-AI-Agent V2.1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b470fec3-97cc-4a41-bde4-e26e6c160261",
  "meta": {
    "instanceId": "c6c1a437e8b16512082bde84b62b61f6117713bbbdf560b47f5bdf35aa8946c8"
  },
  "id": "yQdzMFpscwTbOVBP",
  "tags": []
}