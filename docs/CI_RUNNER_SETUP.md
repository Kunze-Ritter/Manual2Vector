# CI Runner Setup

## Prerequisites
- Windows 10/11 or Windows Server 2019+
- Docker Desktop with WSL2 backend enabled
- NVIDIA GPU with CUDA 11.8+ support
- NVIDIA Container Toolkit installed
- Access to HP E877 PDFs at `C:\Firmwares\HP\`

## Runner Installation
1. Download the GitHub Actions self-hosted runner for Windows.
2. Install the runner as a Windows Service for automatic startup.
3. Configure it with your repository URL and access token.
4. Add labels: `self-hosted`, `windows`.

## PDF Setup
1. Create directory: `C:\Firmwares\HP\`
2. Place files:
   - `HP_E877_SM.pdf` (Service Manual)
   - `HP_E877_CPMD.pdf` (Customer Product Manual/Documentation)
3. Verify file permissions allow Docker read access.

## Verification Commands
```powershell
# Check PDFs exist
Test-Path "C:\Firmwares\HP\HP_E877_SM.pdf"
Test-Path "C:\Firmwares\HP\HP_E877_CPMD.pdf"

# Verify Docker is running
docker ps

# Check GPU availability
nvidia-smi

# Test Docker GPU access
docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
```

## Workflow Triggers

### Manual Trigger
- Navigate to Actions -> Production Pipeline Test -> Run workflow.
- Use for ad-hoc testing before releases or after major changes.
- Allows testing without code push.

### Nightly Schedule
- Runs automatically at 2:00 AM daily (UTC).
- Validates pipeline stability with real production data.
- Catches regressions early.
- Cron expression: `'0 2 * * *'`

### Main Branch Pushes
- Triggers on every push to `main` branch.
- Ensures production pipeline works after merges.
- Provides immediate feedback on breaking changes.
- Prevents broken code from reaching production.

## Error Handling and Validation

### PDF Verification Failure
- Step fails with clear error message if PDFs are missing.
- Prevents wasted CI time on incomplete setup.

### Production Test Failure
- Container exit code propagates to workflow failure.
- Test results artifact uploads even on failure for debugging.
- Error report JSON is generated by `ProductionTestOrchestrator`.

### Dashboard Validation Failure
- Separate screenshots artifact enables visual debugging.
- Playwright errors are captured in test result outputs.
- Artifact upload still runs with `if: always()`.

### Service Cleanup
- `if: always()` ensures `docker-compose down` runs even on failure.
- Prevents resource leaks on the runner.
- Cleans up test database and containers.
